worker_processes  64;
worker_rlimit_nofile 10000;

events {
    worker_connections  10000;
}

http {
    server_tokens off;
    include       mime.types;
    default_type  application/octet-stream;

    limit_conn_zone $binary_remote_addr zone=addr:100m;
    limit_req_zone $binary_remote_addr zone=public:100m rate=4r/s;

    limit_conn addr 32;
    limit_req zone=public burst=15;
    limit_conn_log_level error;
    limit_req_log_level error;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  15;

    gzip  on;

  server {
    listen 8090;

    location /health {
      fastcgi_pass unix:/var/run/fcgiwrap.socket;
      fastcgi_param SCRIPT_FILENAME /usr/local/bin/healthcheck.sh;
    }

    location / {
      access_log off;
      proxy_pass http://ws;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header Host $host;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }

  }
  upstream ws {
